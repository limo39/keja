{% extends 'main.html' %}
{% load property_extras %}

{% block content %}
<main class="layout">
    <div class="container">
        <div class="layout__box">
            <div class="layout__boxHeader">
                <div class="layout__boxTitle">
                    <a href="{% url 'home' %}" class="btn btn--dark btn--small">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Back
                    </a>
                    <h3>{{ property.title }}</h3>
                </div>
                
                {% if property.landlord == request.user %}
                <div class="property-actions">
                    <a href="{% url 'edit_property' property.id %}" class="btn btn--main btn--small">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M18.5 2.50023C18.8978 2.1024 19.4374 1.87891 20 1.87891C20.5626 1.87891 21.1022 2.1024 21.5 2.50023C21.8978 2.89805 22.1213 3.43762 22.1213 4.00023C22.1213 4.56284 21.8978 5.1024 21.5 5.50023L12 15.0002L8 16.0002L9 12.0002L18.5 2.50023Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Edit
                    </a>
                    <a href="{% url 'delete_property' property.id %}" class="btn btn--danger btn--small">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Delete
                    </a>
                </div>
                {% endif %}
            </div>

            <div class="layout__body">
                {% if property.main_image %}
                <div class="property__image">
                    <img src="{{ property.imageURL }}" alt="{{ property.title }}">
                </div>
                {% endif %}

                <div class="property__info">
                    <div class="property__details">
                        <h2>${{ property.rent_amount }}/month</h2>
                        <div class="property__meta">
                            <span class="property__type">{{ property.get_property_type_display }}</span>
                            <span class="property__specs">{{ property.bedrooms }} Bedrooms ‚Ä¢ {{ property.bathrooms }} Bathrooms</span>
                            <span class="property__area">{{ property.area_sqft }} sq ft</span>
                            <span class="property__location">üìç {{ property.location }}</span>
                        </div>
                    </div>

                    <div class="property__landlord">
                        <div class="property__author">
                            <div class="avatar avatar--small">
                                <img src="{{ property.landlord.avatar.url }}" alt="{{ property.landlord.name }}" />
                            </div>
                            <div class="property__authorInfo">
                                <a href="{% url 'user-profile' property.landlord.id %}">{{ property.landlord.name|default:property.landlord.username }}</a>
                                <span>Landlord</span>
                            </div>
                        </div>
                        <span class="property__date">Listed {{ property.created|timesince }} ago</span>
                    </div>
                </div>

                <div class="property__conversation">
                    <div class="property__description">
                        <h3>Description</h3>
                        <p>{{ property.description }}</p>
                    </div>

                    <div class="property__address">
                        <h3>Address</h3>
                        <p>{{ property.address }}</p>
                    </div>

                    {% if property.amenities %}
                    <div class="property__amenities">
                        <h3>Amenities</h3>
                        <div class="amenities-list">
                            {% for amenity in property.amenities|split:"," %}
                                <span class="amenity-tag">{{ amenity|strip }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <div class="property__availability">
                        <h3>Availability</h3>
                        <p>Available from: <strong>{{ property.date_available }}</strong></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="participants">
            <h3 class="participants__top">Contact Landlord</h3>
            <div class="participants__list scroll">
                <div class="participant">
                    <div class="avatar avatar--medium">
                        <img src="{{ property.landlord.avatar.url }}" />
                    </div>
                    <p>{{ property.landlord.name }}</p>
                    <span>{{ property.landlord.email }}</span>
                </div>
            </div>
        </div>
    </div>

    {% if related_properties %}
    <div class="container">
        <h3>Similar Properties in {{ property.location }}</h3>
        <div class="related-properties">
            {% for related in related_properties %}
            <div class="related-property">
                <a href="{% url 'property_detail' related.id %}">
                    {% if related.main_image %}
                    <img src="{{ related.imageURL }}" alt="{{ related.title }}">
                    {% endif %}
                    <h4>{{ related.title }}</h4>
                    <p>${{ related.rent_amount }}/month</p>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</main>

<style>
.property__image img {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: 1rem;
    margin-bottom: 2rem;
}

.property__info {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #eee;
}

.property__details h2 {
    color: #2d3748;
    margin-bottom: 1rem;
}

.property__meta {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    color: #666;
}

.property__meta span {
    font-size: 0.9rem;
}

.property__landlord {
    text-align: right;
}

.property__conversation > div {
    margin-bottom: 2rem;
}

.property__conversation h3 {
    margin-bottom: 1rem;
    color: #2d3748;
}

.amenities-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.amenity-tag {
    background: #e2e8f0;
    padding: 0.3rem 0.8rem;
    border-radius: 1rem;
    font-size: 0.8rem;
    color: #2d3748;
}

.related-properties {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.related-property {
    background: white;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.related-property img {
    width: 100%;
    height: 120px;
    object-fit: cover;
}

.related-property h4, .related-property p {
    padding: 0.5rem;
    margin: 0;
}

.related-property a {
    text-decoration: none;
    color: inherit;
}

@media (max-width: 768px) {
    .property__info {
        flex-direction: column;
        gap: 1rem;
    }
    
    .property__landlord {
        text-align: left;
    }
}
</style>
{% endblock content %}